@startuml MemeLifecycle
title AlmaStreet - Ciclo di Vita Meme (Proposta & IPO)

|#e1f5fe|Studente|
start
:Carica Immagine, Titolo, Descrizione e Categorie;
:Conferma Listing meme;

|#e8f5e9|Backend (Laravel)|
if (Saldo Studente >= Listing Fee?) then (No)
    :Restituisce Errore;
    stop
else (Sì)
    :Start Transaction;
    :Addebita costo in CFU allo Studente;
    :Analisi immagine con IA;
    if (Contenuto Inappropriato?) then (Sì)
        :Rollback Transaction;
        :Restituisce Errore di Contenuto;
        stop
    else (No)
    :Crea Record Meme (Status: UPLOADED);
    :Registra Prezzo Iniziale in PriceHistory;
    :Commit Transaction;
    :Rende il meme visibile nel Market;
    :Invia Notifica al Rettorato;
endif

|#fff3e0|Rettorato (Admin)|
:Riceve notifica "Nuova Meme da Esaminare";
:Esamina Contenuto (Check policy);

if (Meme Approvato?) then (No - Rifiutato)
    :Imposta Status: REJECTED;
    :Soft Delete record;
    |Backend (Laravel)|
    :Invia notifica rifiuto allo Studente;
    stop
else (Sì - Approvato)
    |Rettorato (Admin)|
    :Valuta modifica ai Parametri Finanziari;
    split
        :Base Price (es. 1.00 CFU);
    split again
        :Slope (Rischio/Volatilità);
    end split

    |Backend (Laravel)|
    :Start Transaction;
    :Update Meme Status: APPROVED;
    :Aggiorna Prezzo in PriceHistory;
    :Commit Transaction;
    stop
endif
@enduml